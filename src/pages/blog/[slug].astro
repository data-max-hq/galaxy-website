---
import Layout from '../../layouts/Layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props as { post: CollectionEntry<'blog'> };
const { Content } = await post.render();
const withBase = (path: string) => `${import.meta.env.BASE_URL}${path.replace(/^\/+/g, '')}`;
const blogIndexUrl = withBase('blog/');
const homeUrl = import.meta.env.BASE_URL ?? '/';
const heroSrc = post.data.heroImage ? withBase(post.data.heroImage.src) : undefined;
---

<Layout title={`${post.data.title} | Galaxy Insights`} description={post.data.description} showGlobalNav>
	<article class="mx-auto max-w-3xl px-6 py-16 text-[var(--slate)]">
		<div class="flex flex-wrap gap-4 text-sm text-[var(--accent)]">
			<a href={homeUrl}>← Back to home</a>
			<a href={blogIndexUrl}>← Back to blog</a>
		</div>
		<p class="mt-6 text-xs uppercase tracking-[0.4em] text-[var(--muted)]">
			{post.data.publishDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
		</p>
		<h1 class="mt-3 text-4xl font-semibold text-[var(--slate)]">{post.data.title}</h1>
		<p class="mt-2 text-lg text-[var(--muted)]">{post.data.description}</p>
		{heroSrc && (
			<img src={heroSrc} alt={post.data.heroImage?.alt} class="mt-10 rounded-3xl border border-black/5" />
		)}
		<div class="prose mt-10 max-w-none text-lg leading-relaxed">
			<Content />
		</div>
	</article>
</Layout>
