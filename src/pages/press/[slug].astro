---
import Layout from '../../layouts/Layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const pressEntries = await getCollection('press');
  return pressEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props as { entry: CollectionEntry<'press'> };
const { Content } = await entry.render();
const base = import.meta.env.BASE_URL ?? '/';
const withBase = (path: string) => `${base}${path.replace(/^\/+/, '')}`;
const formatDate = (date: Date) =>
  new Intl.DateTimeFormat('en-US', { month: 'long', day: 'numeric', year: 'numeric' }).format(date);
---

<Layout
  title={`${entry.data.title} | Galaxy Press`}
  description={entry.data.description}
  showGlobalNav={true}
>
  <main class="mx-auto max-w-4xl space-y-10 px-6 py-16">
    <section class="rounded-3xl border border-black/5 bg-white/90 p-8 shadow-sm backdrop-blur" data-animate>
      <p class="text-xs font-semibold uppercase tracking-[0.35em] text-[var(--muted)]">Press release</p>
      <h1 class="mt-3 text-4xl font-semibold text-[var(--slate)] sm:text-5xl">{entry.data.title}</h1>
      <p class="mt-4 flex flex-wrap items-center gap-2 text-sm text-[var(--muted)]">
        <span>{formatDate(entry.data.publishDate)}</span>
        <span aria-hidden="true">•</span>
        <span>{entry.data.location}</span>
      </p>
      <div class="mt-6 flex flex-wrap gap-3 text-sm font-semibold">
        <a
          href={withBase('press/')}
          class="inline-flex items-center gap-2 rounded-full border border-[var(--slate)] px-5 py-2 text-[var(--slate)] transition hover:bg-[var(--slate)] hover:text-white"
        >
          ← Back to press center
        </a>
        <a
          href="mailto:info@galaxy.al"
          class="inline-flex items-center gap-2 rounded-full border border-black/10 px-5 py-2 text-[var(--muted)] hover:text-[var(--slate)]"
        >
          Request interview
        </a>
      </div>
    </section>

    <figure class="overflow-hidden rounded-3xl border border-black/5" data-animate>
      <img src={withBase(entry.data.banner.src)} alt={entry.data.banner.alt} width="1600" height="640" class="w-full" />
      <figcaption class="bg-[var(--slate)]/90 px-6 py-3 text-sm text-white">{entry.data.location}</figcaption>
    </figure>

    <section class="flex flex-col gap-6 lg:flex-row" data-animate>
      {entry.data.highlights.length > 0 && (
        <aside class="rounded-2xl border border-black/5 bg-white/90 p-6 text-sm text-[var(--muted)] shadow-sm lg:w-64">
          <h2 class="text-base font-semibold text-[var(--slate)]">Highlights</h2>
          <ul class="mt-3 list-disc space-y-2 pl-5">
            {entry.data.highlights.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </aside>
      )}
      <article class="flex-1 rounded-3xl border border-black/5 bg-white/95 p-8 shadow-md">
        <div class="prose max-w-none prose-headings:text-[var(--slate)] prose-p:text-[var(--ink)] prose-strong:text-[var(--slate)]">
          <Content />
        </div>
      </article>
    </section>
  </main>
</Layout>
